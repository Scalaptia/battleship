(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function i(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(e){if(e.ep)return;e.ep=!0;const s=i(e);fetch(e.href,s)}})();const c=r=>({length:r,hits:0,sunk:!1,hit(){this.isSunk()||this.hits++,this.isSunk()&&(this.sunk=!0)},isSunk(){return this.hits===this.length}}),b=(r,a)=>({boardGrid:Array.from({length:r},()=>Array.from({length:a},()=>({ship:null,hit:!1}))),ships:[],missedShots:0,placeShip(t,e,s,o){if(t={...t},this.ships.push(t),o){if(s+t.length>this.boardGrid.length)return this.ships.pop(),!1;for(let n=0;n<t.length;n++){if(this.boardGrid[s+n][e].ship)return this.ships.pop(),!1;this.boardGrid[s+n][e].ship=t}}else{if(e+t.length>this.boardGrid[0].length)return this.ships.pop(),!1;for(let n=0;n<t.length;n++){if(this.boardGrid[s][e+n].ship)return this.ships.pop(),!1;this.boardGrid[s][e+n].ship=t}}return!0},receiveAttack(t,e){const s=this.boardGrid[t][e];s.hit||(s.hit=!0,s.ship?(s.ship.hit(),console.log(s.ship)):this.missedShots++)},allSunk(){return this.ships.every(t=>t.sunk)},addRandomShip(t){let e=!1;for(;!e;){let s=Math.floor(Math.random()*this.boardGrid[0].length),o=Math.floor(Math.random()*this.boardGrid.length),n=Math.random()<.5;e=this.placeShip(t,s,o,n)}},addRandomShips(){this.addRandomShip(c(5)),this.addRandomShip(c(4)),this.addRandomShip(c(3)),this.addRandomShip(c(3)),this.addRandomShip(c(2))}}),k=r=>({name:r,gameboard:b(10,10),attack(i,t,e){i.receiveAttack(t,e)},attackRand(i){let t,e;do t=Math.floor(Math.random()*10),e=Math.floor(Math.random()*10);while(i.boardGrid[e][t].hit);i.receiveAttack(e,t)}}),y={Carrier:c(5),Battleship:c(4),Cruiser:c(3),Submarine:c(3),Destroyer:c(2)},m=(r,a,i)=>{const t=r.querySelector(".board-top");t.innerHTML="";for(let e=0;e<a.boardGrid.length;e++)for(let s=0;s<a.boardGrid[e].length;s++){const o=document.createElement("cell");o.dataset.y=`${e}`,o.dataset.x=`${s}`,o.addEventListener("dragover",n=>{n.preventDefault()}),o.addEventListener("drop",n=>{n.preventDefault();const f=n.dataTransfer.getData("text"),E=n.target,L=parseInt(E.dataset.x),v=parseInt(E.dataset.y),S=document.querySelector(`[data-ship="${f}"]`).classList.contains("vertical");if(console.log(f,L,v,S),a.placeShip(y[f],L,v,S)){m(r,a,!0);const G=document.querySelector(`[data-ship="${f}"]`);G.draggable=!1,G.remove()}}),i&&a.boardGrid[e][s].ship&&o.classList.add("ship"),a.boardGrid[e][s].ship?a.boardGrid[e][s].hit&&(a.boardGrid[e][s].ship.sunk?o.classList.add("sunk"):o.classList.add("hit")):a.boardGrid[e][s].hit&&o.classList.add("miss"),t.appendChild(o)}},C=r=>{const a=document.createElement("board");a.id=r;const i=document.createElement("div");i.classList.add("board-top"),a.appendChild(i);const t=document.createElement("div");t.classList.add("board-side"),a.appendChild(t);const e=document.createElement("div");return e.classList.add("board-front"),a.appendChild(e),a},u=document.getElementById("boards-container"),g=C("p1-board");u.appendChild(g);const h=k("Player 1");m(g,h.gameboard,!0);const p=C("cpu-board");p.classList.toggle("hidden");u.appendChild(p);const d=k("CPU");d.gameboard.addRandomShips();m(p,d.gameboard,!1);const w=document.getElementById("ships-container"),M=document.getElementById("ships"),R=document.querySelector(".play-btn"),I=document.querySelector(".reset-btn"),B=()=>{for(const r in y){const a=y[r],i=document.createElement("div");i.classList.add("ui-ship"),i.dataset.ship=r,i.addEventListener("click",()=>{i.classList.toggle("vertical")}),i.draggable=!0,i.addEventListener("dragstart",t=>{t.dataTransfer.setData("text",r)});for(let t=0;t<a.length;t++){const e=document.createElement("cell");e.classList.add("ship"),i.appendChild(e)}M.appendChild(i)}};B();const T=async()=>{w.classList.add("hidden"),p.classList.remove("hidden"),u.classList.add("isometric"),await P(),u.classList.remove("isometric");const r=document.createElement("div");r.classList.add("modal"),r.innerHTML=`
        <div class="modal-content">
            <h2>${l.textContent}</h2>
            <button class="reset-btn" style="width: 100%;">Play again</button>
        </div>
    `,r.querySelector(".reset-btn").addEventListener("click",()=>{x(),r.remove()}),document.body.appendChild(r)};R.addEventListener("click",()=>{h.gameboard.ships.length>=5&&T()});const x=()=>{h.gameboard=b(10,10),d.gameboard=b(10,10),d.gameboard.addRandomShips(),M.innerHTML="",B(),m(g,h.gameboard,!0),m(p,d.gameboard,!1),w.classList.remove("hidden"),p.classList.add("hidden"),u.classList.remove("isometric"),l.textContent="Place your ships",l.style.color="white"};I.addEventListener("click",()=>{x()});const l=document.getElementById("header"),$=r=>new Promise(a=>setTimeout(a,r)),q=()=>new Promise(r=>{const a=p.querySelector(".board-top");a.addEventListener("click",function i(t){const e=t.target,s=parseInt(e.dataset.x),o=parseInt(e.dataset.y);d.gameboard.boardGrid[o][s].hit||(d.gameboard.receiveAttack(o,s),m(p,d.gameboard,!1),a.removeEventListener("click",i),r(()=>{}))})}),P=async()=>{if(l.style.color="white",l.textContent=`${h.name}'s turn`,await q(),m(p,d.gameboard,!1),d.gameboard.allSunk()){l.textContent=`${h.name} won!`,l.style.color="hsl(125, 60%, 48%)";return}if(l.textContent=`${d.name}'s turn`,await $(1e3),d.attackRand(h.gameboard),m(g,h.gameboard,!0),h.gameboard.allSunk()){l.textContent=`${d.name} won!`,l.style.color="red";return}await P()};
