(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&t(o)}).observe(document,{childList:!0,subtree:!0});function n(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(e){if(e.ep)return;e.ep=!0;const s=n(e);fetch(e.href,s)}})();const h=a=>({length:a,hits:0,sunk:!1,hit(){this.isSunk()||this.hits++,this.isSunk()&&(this.sunk=!0)},isSunk(){return this.hits===this.length}}),C=(a,r)=>({boardGrid:Array.from({length:a},()=>Array.from({length:r},()=>({ship:null,hit:!1}))),ships:[],missedShots:0,placeShip(t,e,s,o){t={...t},this.ships.push(t);const l=(i,g)=>{const b=[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,-1],[-1,1],[1,1]];for(let E=0;E<b.length;E++){const[L,v]=b[E],G=i+L,k=g+v;if(G>=0&&G<this.boardGrid[0].length&&k>=0&&k<this.boardGrid.length&&this.boardGrid[k][G].ship)return!0}return!1},f=(i,g)=>!!this.boardGrid[g][i].ship;if(o){if(s+t.length>this.boardGrid.length)return this.ships.pop(),!1;for(let i=0;i<t.length;i++)if(f(e,s+i)||l(e,s+i))return this.ships.pop(),!1;for(let i=0;i<t.length;i++)this.boardGrid[s+i][e].ship=t}else{if(e+t.length>this.boardGrid[0].length)return this.ships.pop(),!1;for(let i=0;i<t.length;i++)if(f(e+i,s)||l(e+i,s))return this.ships.pop(),!1;for(let i=0;i<t.length;i++)this.boardGrid[s][e+i].ship=t}return!0},receiveAttack(t,e){const s=this.boardGrid[t][e];s.hit||(s.hit=!0,s.ship?(s.ship.hit(),console.log(s.ship)):this.missedShots++)},allSunk(){return this.ships.every(t=>t.sunk)},addRandomShip(t){let e=!1;for(;!e;){let s=Math.floor(Math.random()*this.boardGrid[0].length),o=Math.floor(Math.random()*this.boardGrid.length),l=Math.random()<.5;e=this.placeShip(t,s,o,l)}},addRandomShips(){this.addRandomShip(h(5)),this.addRandomShip(h(4)),this.addRandomShip(h(3)),this.addRandomShip(h(3)),this.addRandomShip(h(2))}}),M=a=>({name:a,gameboard:C(10,10),attack(n,t,e){n.receiveAttack(t,e)},attackRand(n){let t,e;do t=Math.floor(Math.random()*10),e=Math.floor(Math.random()*10);while(n.boardGrid[e][t].hit);n.receiveAttack(e,t)}}),w={Carrier:h(5),Battleship:h(4),Cruiser:h(3),Submarine:h(3),Destroyer:h(2)},m=(a,r,n)=>{const t=a.querySelector(".board-top");t.innerHTML="";for(let e=0;e<r.boardGrid.length;e++)for(let s=0;s<r.boardGrid[e].length;s++){const o=document.createElement("cell");o.dataset.y=`${e}`,o.dataset.x=`${s}`,o.addEventListener("dragover",l=>{l.preventDefault()}),o.addEventListener("drop",l=>{l.preventDefault();const f=l.dataTransfer.getData("text"),i=l.target,g=parseInt(i.dataset.x),b=parseInt(i.dataset.y),L=document.querySelector(`[data-ship="${f}"]`).classList.contains("vertical");if(console.log(f,g,b,L),r.placeShip(w[f],g,b,L)){m(a,r,!0);const v=document.querySelector(`[data-ship="${f}"]`);v.draggable=!1,v.remove()}}),n&&r.boardGrid[e][s].ship&&o.classList.add("ship"),r.boardGrid[e][s].ship?r.boardGrid[e][s].hit&&(r.boardGrid[e][s].ship.sunk?o.classList.add("sunk"):o.classList.add("hit")):r.boardGrid[e][s].hit&&o.classList.add("miss"),t.appendChild(o)}},B=a=>{const r=document.createElement("board");r.id=a;const n=document.createElement("div");n.classList.add("board-top"),r.appendChild(n);const t=document.createElement("div");t.classList.add("board-side"),r.appendChild(t);const e=document.createElement("div");return e.classList.add("board-front"),r.appendChild(e),r},y=document.getElementById("boards-container"),S=B("p1-board");y.appendChild(S);const p=M("Player 1");m(S,p.gameboard,!0);const u=B("cpu-board");u.classList.toggle("hidden");y.appendChild(u);const d=M("CPU");d.gameboard.addRandomShips();m(u,d.gameboard,!1);const P=document.getElementById("ships-container"),R=document.getElementById("ships"),$=document.querySelector(".play-btn"),q=document.querySelector(".reset-btn"),I=()=>{for(const a in w){const r=w[a],n=document.createElement("div");n.classList.add("ui-ship"),n.dataset.ship=a,n.addEventListener("click",()=>{n.classList.toggle("vertical")}),n.draggable=!0,n.addEventListener("dragstart",t=>{t.dataTransfer.setData("text",a)});for(let t=0;t<r.length;t++){const e=document.createElement("cell");e.classList.add("ship"),n.appendChild(e)}R.appendChild(n)}};I();const A=async()=>{P.classList.add("hidden"),u.classList.remove("hidden"),y.classList.add("isometric"),await x(),y.classList.remove("isometric");const a=document.createElement("div");a.classList.add("modal"),a.innerHTML=`
        <div class="modal-content">
            <h2>${c.textContent}</h2>
            <button class="reset-btn" style="width: 100%;">Play again</button>
        </div>
    `,a.querySelector(".reset-btn").addEventListener("click",()=>{T(),a.remove()}),document.body.appendChild(a)};$.addEventListener("click",()=>{p.gameboard.ships.length>=5&&A()});const T=()=>{p.gameboard=C(10,10),d.gameboard=C(10,10),d.gameboard.addRandomShips(),R.innerHTML="",I(),m(S,p.gameboard,!0),m(u,d.gameboard,!1),P.classList.remove("hidden"),u.classList.add("hidden"),y.classList.remove("isometric"),c.textContent="Place your ships",c.style.color="white"};q.addEventListener("click",()=>{T()});const c=document.getElementById("header"),O=a=>new Promise(r=>setTimeout(r,a)),D=()=>new Promise(a=>{const r=u.querySelector(".board-top");r.addEventListener("click",function n(t){const e=t.target,s=parseInt(e.dataset.x),o=parseInt(e.dataset.y);d.gameboard.boardGrid[o][s].hit||(d.gameboard.receiveAttack(o,s),m(u,d.gameboard,!1),r.removeEventListener("click",n),a(()=>{}))})}),x=async()=>{if(c.style.color="white",c.textContent=`${p.name}'s turn`,await D(),m(u,d.gameboard,!1),d.gameboard.allSunk()){c.textContent=`${p.name} won!`,c.style.color="hsl(125, 60%, 48%)";return}if(c.textContent=`${d.name}'s turn`,await O(500),d.attackRand(p.gameboard),m(S,p.gameboard,!0),p.gameboard.allSunk()){c.textContent=`${d.name} won!`,c.style.color="red";return}await x()};
